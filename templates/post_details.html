{% extends 'base.html' %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<h1>{{ post.title }}</h1>
<p>{{ post.content }}</p>
<p><small>Posted by {{ post.user.username }}</small></p>

<h2>Comments</h2>
<ul>
    {% for comment in comments %}
        <li>
            {{ comment.content }} (by {{ comment.user.username }})
            {% if session.get('user_id') == comment.user.id %}
                | <a href="{{ url_for('main.edit_comment', comment_id=comment.id) }}">Edit</a>
                |
                <form action="{{ url_for('main.delete_comment', comment_id=comment.id) }}" method="post" style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" onclick="return confirm('Delete this comment?')">Delete</button>
                </form>
            {% endif %}
        </li>
    {% else %}
        <li>No comments yet.</li>
    {% endfor %}
</ul>

{% if session.get('user_id') %}
    <a href="{{ url_for('main.create_comment', post_id=post.id) }}">Add Comment</a>
{% else %}
    <p><a href="{{ url_for('main.login') }}">Login</a> to add comments.</p>
{% endif %}

<a href="{{ url_for('main.index') }}">Back to Posts</a>
{% endblock %}
